<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Tw√≥j portfel</title>
</head>
<body>
    <nav>
        <a href="{{ url_for('index') }}">üè† Strona g≈Ç√≥wna</a> |
        <a href="{{ url_for('add_crypto') }}">‚ûï Dodaj kryptowalutƒô</a> |
        <a href="{{ url_for('portfolio_view') }}">üìã Portfel</a> |
        <a href="{{ url_for('chart_redirect') }}">üìà Wykres</a> |
        <a href="{{ url_for('forecast_view') }}">üìä Prognoza</a> |
        <a href="{{ url_for('optimize_view') }}">‚öôÔ∏è Optymalizacja</a> |
        <a href="{{ url_for('alerts_view') }}">üîî Powiadomienia</a>
    </nav>
    <hr>

    <h1>Tw√≥j portfel</h1>
    <table border="1">
        <thead>
            <tr>
                <th>Kryptowaluta</th>
                <th>Ilo≈õƒá</th>
                <th>Cena (USD)</th>
                <th>Warto≈õƒá</th>
                <th>Akcje</th>
            </tr>
        </thead>
        <tbody>
            {% for asset in assets %}
            <tr>
                <td>{{ asset.crypto_name }}</td>
                <td>{{ asset.amount }}</td>
                <td>{{ asset.price }}</td>
                <td>{{ "%.2f"|format(asset.amount * asset.price) }}</td>
                <td>
                    <form action="{{ url_for('delete_asset', symbol=asset.crypto_name) }}" method="post">
                        <input type="number" name="amount" step="any" min="0.00000001" max="{{ asset.amount }}" required>
                        <button type="submit">Usu≈Ñ</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <p><strong>Warto≈õƒá ca≈Çkowita:</strong> <span id="total-value">{{ "%.2f"|format(total_value) }} USD</span></p>

    <script>
        function updatePortfolioTable() {
            fetch("/api/portfolio")
                .then(res => res.json())
                .then(data => {
                    const tbody = document.querySelector("table tbody");
                    tbody.innerHTML = "";

                    data.assets.forEach(asset => {
                        const row = document.createElement("tr");
                        row.innerHTML = `
                            <td>${asset.crypto_name}</td>
                            <td>${asset.amount}</td>
                            <td>${asset.price.toFixed(2)}</td>
                            <td>${asset.value.toFixed(2)}</td>
                            <td>
                                <form action="/delete/${asset.crypto_name}" method="post">
                                    <input type="number" name="amount" step="any" min="0.00000001" max="${asset.amount}" required>
                                    <button type="submit">Usu≈Ñ</button>
                                </form>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });

                    document.getElementById("total-value").innerText = data.total_value.toFixed(2) + " USD";
                });
        }

        setInterval(updatePortfolioTable, 5000);
    </script>
</body>
</html>
